function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,r,o){return r&&_defineProperties(e.prototype,r),o&&_defineProperties(e,o),e}function _sliceIterator(e,r){var o=[],a=!0,t=!1,n=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(o.push(i.value),!r||o.length!==r);a=!0);}catch(e){t=!0,n=e}finally{try{a||null==l.return||l.return()}finally{if(t)throw n}}return o}function _slicedToArray(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return _sliceIterator(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}!function a(t,n,i){function l(r,e){if(!n[r]){if(!t[r]){var o="function"==typeof require&&require;if(!e&&o)return o(r,!0);if(s)return s(r,!0);throw(o=new Error("Cannot find module '"+r+"'")).code="MODULE_NOT_FOUND",o}o=n[r]={exports:{}},t[r][0].call(o.exports,function(e){return l(t[r][1][e]||e)},o,o.exports,a,t,n,i)}return n[r].exports}for(var s="function"==typeof require&&require,e=0;e<i.length;e++)l(i[e]);return l}({1:[function(e,r,o){r.exports=function(){function a(){var e=window.location.hash,e=(e=e&&e.split("#")[1]).split("&"),o={};return e.forEach(function(e,r){""!=(e=e.split("="))[0]&&(o[e[0]]=e[1])}),o}function t(e){var o=Object.keys(e),a=Object.values(e),t=[];o.forEach(function(e,r){""!=e&&t.push(o[r]+"="+a[r])});e=t.join("&");window.location.hash=e}return{getUrlHashParameter:function(e){return a()[e]},getUrlHashParameters:a,setUrlHashParameter:function(e,r){var o=a();o[e]=r,t(o)},setUrlHashParameters:t}}},{}],2:[function(o,e,r){window.Infragram=function(r){(r=r||{}).uploader=r.uploader||!1,r.processor=r.processor||"javascript",r.camera=o("./io/camera")(r),r.colorized=r.colorized||!1,r.mode=r.mode||"raw",r.video_live=r.video_live||!1,r.webGlSupported=r.webGlSupported||!1,r.processors={webgl:o("./processors/webgl"),javascript:o("./processors/javascript")},r.processor=r.processors[r.processor](r),r.file=o("./io/file")(r,r.processor),r.logger=o("./logger")(r);var e=o("./ui/interface")(r);return console.log("processor:",r.processor.type),r.colorize=function(e){r.processor.colorize(e)},r.run=function(e){return r.logger.save_log(),r.processor.run(e)},r.video=function(){var e;r.camera.initialize(),e="webgl"==r.processor.type?15:150,setInterval(function(){image&&r.run(r.mode),r.camera.getSnapshot()},e)},{Camera:r.camera,Interface:e,logger:r.logger,run:r.run,colorize:r.colorize,processors:r.processors,download:function(){r.file.downloadImage()},options:r}},e.exports=Infragram},{"./io/camera":7,"./io/file":8,"./logger":9,"./processors/javascript":10,"./processors/webgl":11,"./ui/interface":15}],3:[function(e,r,o){r.exports=function(p){return function(e){var r,o,a,t,n,i,l=[p[d=m=0][0],1],s=l[1];if(e<(g=l[0]))return m;for(r=o=0,a=p.length;o<a;r=++o){var c=_slicedToArray(p[r],3),u=c[0],m=c[1],d=c[2],g=u;if(r===p.length-1){s=1;break}if(s=p[r+1][0],u<=e&&e<s)break}for(i=[],r=t=0,n=m.length;0<=n?t<n:n<t;r=0<=n?++t:--t)i[r]=(e-g)/(s-g)*(d[r]-m[r])+m[r];return i}}},{}],4:[function(e,r,o){r.exports={greyscale:{author:"publiclab",description:"A simple linear greyscale colormap, black to white.",url:"https://publiclab.org/colormaps#greyscale",colormapRanges:[[0,[0,0,0],[255,255,255]],[1,[255,255,255],[255,255,255]]]},default:{author:"publiclab",description:"A full-colorwheel colormap, covering the colors in the spectrum.",url:"https://publiclab.org/colormaps#default",colormapRanges:[[0,[45,1,121],[25,1,137]],[.125,[25,1,137],[0,6,156]],[.1875,[0,6,156],[7,41,172]],[.25,[7,41,172],[22,84,187]],[.3125,[22,84,187],[25,125,194]],[.375,[25,125,194],[26,177,197]],[.4375,[26,177,197],[23,199,193]],[.47,[23,199,193],[25,200,170]],[.5,[25,200,170],[21,209,27]],[.5625,[21,209,27],[108,215,18]],[.625,[108,215,18],[166,218,19]],[.6875,[166,218,19],[206,221,20]],[.75,[206,221,20],[222,213,19]],[.7813,[222,213,19],[222,191,19]],[.8125,[222,191,19],[227,133,17]],[.875,[227,133,17],[231,83,16]],[.9375,[231,83,16],[220,61,48]]]},stretched:{author:"publiclab",description:"A simple colormap from blue to red, with no purple overlap.",url:"https://publiclab.org/colormaps#stretched",colormapRanges:[[0,[0,0,255],[0,0,255]],[.1,[0,0,255],[38,195,195]],[.5,[0,150,0],[255,255,0]],[.7,[255,255,0],[255,50,50]],[.9,[255,50,50],[255,50,50]]]},bluwhtgrngis:{author:"MaggPi",description:"A colormap from blue to white to green to....",url:"https://publiclab.org/colormaps#bluwhtgrngis",colormapRanges:[[0,[6,23,86],[6,25,84]],[.0625,[6,25,84],[6,25,84]],[.125,[6,25,84],[6,25,84]],[.1875,[6,25,84],[6,25,84]],[.25,[6,25,84],[6,25,84]],[.3125,[6,25,84],[9,24,84]],[.3438,[9,24,84],[119,120,162]],[.375,[119,129,162],[249,250,251]],[.406,[249,250,251],[255,255,255]],[.4375,[255,255,255],[255,255,255]],[.5,[255,255,255],[214,205,191]],[.52,[214,205,191],[178,175,96]],[.5625,[178,175,96],[151,176,53]],[.593,[151,176,53],[146,188,12]],[.625,[146,188,12],[96,161,1]],[.6875,[96,161,1],[30,127,3]],[.75,[30,127,3],[0,99,1]],[.8125,[0,99,1],[0,74,1]],[.875,[0,74,1],[0,52,0]],[.9375,[0,52,0],[0,34,0]],[.968,[0,34,0],[68,70,67]]]},brntogrn:{author:"MaggPi",description:"A colormap from brown to green.",url:"https://publiclab.org/colormaps#brntogrn",colormapRanges:[[0,[110,12,3],[118,6,1]],[.0625,[118,6,1],[141,19,6]],[.125,[141,19,6],[165,35,13]],[.1875,[165,35,13],[177,59,25]],[.2188,[177,59,25],[192,91,36]],[.25,[192,91,36],[214,145,76]],[.3125,[214,145,76],[230,183,134]],[.375,[230,183,134],[243,224,194]],[.4375,[243,224,194],[250,252,229]],[.5,[250,252,229],[217,235,185]],[.5625,[217,235,185],[184,218,143]],[.625,[184,218,143],[141,202,89]],[.6875,[141,202,89],[80,176,61]],[.75,[80,176,61],[0,147,32]],[.8125,[0,147,32],[1,122,22]],[.875,[1,122,22],[0,114,19]],[.9,[0,114,19],[0,105,18]],[.9375,[0,105,18],[7,70,14]]]},blutoredjet:{author:"MaggPi",description:"A colormap from blue to red.",url:"https://publiclab.org/colormaps#blutoredjet",colormapRanges:[[0,[0,0,140],[1,1,186]],[.0625,[1,1,186],[0,1,248]],[.125,[0,1,248],[0,70,254]],[.1875,[0,70,254],[0,130,255]],[.25,[0,130,255],[2,160,255]],[.2813,[2,160,255],[0,187,255]],[.3125,[0,187,255],[6,250,255]],[.348,[0,218,255],[8,252,251]],[.375,[8,252,251],[27,254,228]],[.406,[27,254,228],[70,255,187]],[.4375,[70,255,187],[104,254,151]],[.47,[104,254,151],[132,255,19]],[.5,[132,255,19],[195,255,60]],[.5625,[195,255,60],[231,254,25]],[.5976,[231,254,25],[253,246,1]],[.625,[253,246,1],[252,210,1]],[.657,[252,210,1],[255,183,0]],[.6875,[255,183,0],[255,125,2]],[.75,[255,125,2],[255,65,1]],[.8125,[255,65,1],[247,1,1]],[.875,[247,1,1],[200,1,3]],[.9375,[200,1,3],[122,3,2]]]},colors16:{author:"publiclab",description:"A segmented colormap of the full color spectrum, divided into 16 colors.",url:"https://publiclab.org/colormaps#colors16",colormapRanges:[[0,[0,0,0],[0,0,0]],[.0625,[3,1,172],[3,1,172]],[.125,[3,1,222],[3,1,222]],[.1875,[0,111,255],[0,111,255]],[.25,[3,172,255],[3,172,255]],[.3125,[1,226,255],[1,226,255]],[.375,[2,255,0],[2,255,0]],[.4375,[198,254,0],[190,254,0]],[.5,[252,255,0],[252,255,0]],[.5625,[255,223,3],[255,223,3]],[.625,[255,143,3],[255,143,3]],[.6875,[255,95,3],[255,95,3]],[.75,[242,0,1],[242,0,1]],[.8125,[245,0,170],[245,0,170]],[.875,[223,180,225],[223,180,225]],[.9375,[255,255,255],[255,255,255]]]},fastie:{author:"cfastie",description:"A colormap for highlighting NDVI values over 0 on a scale from -1 to 1; in this scale, values from 0-0.5 are greyscale, while those over 0.5 are color.",url:"https://publiclab.org/colormaps#fastie",colormapRanges:[[0,[255,255,255],[0,0,0]],[.167,[0,0,0],[255,255,255]],[.33,[255,255,255],[0,0,0]],[.5,[0,0,0],[140,140,255]],[.55,[140,140,255],[0,255,0]],[.63,[0,255,0],[255,255,0]],[.75,[255,255,0],[255,0,0]],[.95,[255,0,0],[255,0,255]]]}}},{}],5:[function(a,e,r){e.exports=function(e){var r=a("./colormapFunctionGenerator.js"),o=a("./colormaps.json");Object.keys(o).forEach(function(e){o[e].fn=r(o[e].colormapRanges)});var m=a("../util/JsImage.js");return{colorify:function(e,r){var o,a,t,n,i,l;for($("#btn-colorize").addClass("active"),i=e.width*e.height,o=new Uint8ClampedArray(4*i),a=n=t=0,l=i;0<=l?n<l:l<n;a=0<=l?++n:--n){var s=_slicedToArray(r(e.data[a]),3),c=s[0],u=s[1],s=s[2];o[t++]=c,o[t++]=u,o[t++]=s,o[t++]=255}return new m(o,e.width,e.height,4)},colormap1:o.default.fn,colormap2:o.stretched.fn,greyscale_colormap:o.greyscale.fn,segmented_colormap:r}}},{"../util/JsImage.js":17,"./colormapFunctionGenerator.js":3,"./colormaps.json":4}],6:[function(e,r,o){r.exports=window.Converters={hsv2rgb:function(e,r,o){var a,t,n,i,l,s;if(0===r)l=[o,o,o];else switch(i=o*(1-(a=6*e-(t=Math.floor(6*e)))*r),s=o*(1-(1-a)*r),n=o*(1-r),t){case 0:l=[o,s,n];break;case 1:l=[i,o,n];break;case 2:l=[n,o,s];break;case 3:l=[n,i,o];break;case 4:l=[s,n,o];break;default:l=[o,n,i]}return l},rgb2hsv:function(e,r,o){var a,t=Math.max(e,r,o),n=Math.min(e,r,o),i=a=t,l=t-n,s=0===t?0:l/t;if(t===n)i=0;else{switch(t){case e:i=(r-o)/l+(r<o?6:0);break;case r:i=(o-e)/l+2;break;case o:i=(e-r)/l+4}i/=6}return[i,s,a]}}},{}],7:[function(e,r,o){r.exports=function(r){var e,c;var u=r.webRtcOptions||{audio:!1,video:!0,el:"webcam",extern:null,append:!0,width:640,height:480,mode:"callback",debug:function(){},onCapture:function(){return window.webcam.save()},onSave:o,onLoad:function(){}};function o(e){for(var r,o,a=0,t=e.split(""),n=camera.image,i=u.width,e=u.height,l=r=0,s=i-1;0<=s?r<=s:s<=r;l=0<=s?++r:--r)o=parseInt(t[l],10),n.data[a+0]=o>>16&255,n.data[a+1]=o>>8&255,n.data[a+2]=255&o,n.data[a+3]=255,a+=4;if(4*i*e<=a)return c.putImageData(n,0,0),0}function a(r){var e;if("webrtc"===u.context)return e=u.videoEl,navigator.mozGetUserMedia?e.mozSrcObject=r:e.srcObject=r,e.onerror=function(e){return r.stop()}}function t(e){return alert("No camera available."),console.log(e),console.error("An error occurred: [CODE "+e.code+"]")}return{getSnapshot:function(){var e;return"webrtc"===u.context?(e=document.getElementsByTagName("video")[0],r.processor.updateImage(e),$("#webcam").hide()):"flash"===u.context?window.webcam.capture():void console.log("No context was supplied to getSnapshot()")},initialize:function(){getUserMedia(u,a,t),u.videoEl.setAttribute("autoplay","autoplay"),u.videoEl.setAttribute("playsinline","playsinline"),window.webcam=u,e=r.canvas||document.getElementById("image"),c=e.getContext("2d"),$("#snapshot").show(),$("#live-video").show(),$("#webcam").show()},onSaveGetUserMedia:o,webRtcOptions:u}}},{}],8:[function(e,r,o){r.exports=function(a,t){var o=function(){function a(){return{bubbles:!1,cancelable:!1,screenX:0,screenY:0,clientX:0,clientY:0}}try{new MouseEvent("t"),o=function(){return function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a();return new MouseEvent(e,r)}}}catch(e){o=function(){return function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a(),o=document.createEvent("MouseEvent");return o.initMouseEvent(e,r.bubbles,r.cancelable,window,0,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),o}}}return o()};return{fetchImage:function(r,o){var e;return $("#save-modal-btn").show(),$("#save-zone").show(),e=new Image,a.uploader&&(e.onload=function(){var e=r.split("/");if(e=e[e.length-1],FileUpload.setFilename(e),o&&("infra"===o.substring(0,5)?$("#modeSwitcher").val(o).change():($("button#"+o).button("toggle"),$("button#"+o).click())),a.save_infragrammar_expressions(params),"ndvi"===o?(a.save_infragrammar_expressions({m:"(R-B)/(R+B)"}),o="infragrammar_mono"):"nir"===o?(a.save_infragrammar_expressions({m:"R"}),o="infragrammar_mono"):"raw"===o&&(a.save_infragrammar_expressions({r:"R",g:"G",b:"B"}),o="infragrammar"),t.updateImage(this),"true"!==params.color&&"true"!==params.c||(a.colorized=!0),run_infragrammar(o),"true"!==params.color&&"true"!==params.c||(a.colorized=!0),a.colorized)return $("button#color").button("toggle"),run_colorize()}),e.src=r},downloadImage:function(){var e,r=document.createElement("a");return r.href=t.getCurrentImage(),e=r.href.match("image/jpeg")?"jpg":"png",r.download=(new Date).toISOString().replace(/:/g,"_")+"."+e,document.createEvent?(e=o(),r.dispatchEvent(e("click",{screenX:0,screenY:0,clientX:0,clientY:0}))):r.fireEvent&&r.fireEvent("onclick"),!0}}}},{}],9:[function(e,r,o){r.exports=function(r){var o=[];function e(){var e="mode=infragrammar_mono";return e+=$("#m_exp").val()?"&m="+$("#m_exp").val():"",e+=r.colorized?"&c=true":"",o.push(e)}function a(){var e="mode=infragrammar_hsv";return e+=$("#h_exp").val()?"&h="+$("#h_exp").val():"",e+=$("#s_exp").val()?"&s="+$("#s_exp").val():"",e+=$("#v_exp").val()?"&v="+$("#v_exp").val():"",o.push(e)}function t(){var e="mode=infragrammar";return e+=$("#r_exp").val()?"&r="+$("#r_exp").val():"",e+=$("#g_exp").val()?"&g="+$("#g_exp").val():"",e+=$("#b_exp").val()?"&b="+$("#b_exp").val():"",o.push(e)}return{log:o,log_hsv:a,log_mono:e,log_rgb:t,save_log:function(){return"infragrammar_mono"===r.mode?e():"infragrammar_hsv"===r.mode?a():"infragrammar"===r.mode?t():void 0}}}},{}],10:[function(require,module,exports){module.exports=function javascriptProcessor(){var b_exp="",g_exp="",get_channels,Colormaps=require("../color/colormaps")(JsImage),colormap=Colormaps.colormap1,converters=require("../color/converters"),image=null,mode="raw",ndvi,r_exp="",set_mode,update_colorbar,JsImage=require("../util/JsImage.js");function get_channels(r){for(var e,o,a=r.width*r.height,t=new Float32Array(a),n=new Float32Array(a),i=new Float32Array(a),l=e=0,s=a;0<=s?e<s:s<e;l=0<=s?++e:--e)t[l]=r.data[4*l+0],n[l]=r.data[4*l+1],i[l]=r.data[4*l+2];function o(e){return new JsImage(e,r.width,r.height,1)}return[o(t),o(n),o(i)]}function ndvi(e,r){for(var o,a=e.width*e.height,t=new Float64Array(a),n=o=0,i=a;0<=i?o<i:i<o;n=0<=i?++o:--o)t[n]=(e.data[n]-r.data[n])/(e.data[n]+r.data[n]);return new JsImage(t,e.width,e.height,1)}function infragrammar(e){var r,o,a,t,n,i,l,s;for($("#btn-colorize").removeClass("active"),n=e.width*e.height,l=new Float32Array(n),o=new Float32Array(n),r=new Float32Array(n),i=new Float32Array(4*n),a=t=0,s=n;0<=s?t<s:s<t;a=0<=s?++t:--t)l[a]=e.data[4*a+0]/255,o[a]=e.data[4*a+1]/255,r[a]=e.data[4*a+2]/255,i[4*a+0]=255*r_exp(l[a],o[a],r[a]),i[4*a+1]=255*g_exp(l[a],o[a],r[a]),i[4*a+2]=255*b_exp(l[a],o[a],r[a]),i[4*a+3]=255;return new JsImage(i,e.width,e.height,4)}function infragrammar_mono(e){for(var r,o=e.width*e.height,a=new Float32Array(o),t=new Float32Array(o),n=new Float32Array(o),i=new Float32Array(o),l=r=0,s=o;0<=s?r<s:s<r;l=0<=s?++r:--r)a[l]=e.data[4*l+0]/255,t[l]=e.data[4*l+1]/255,n[l]=e.data[4*l+2]/255,i[l]=r_exp(a[l],t[l],n[l]);return new JsImage(i,e.width,e.height,1)}function render(e){var r,o=$("#image")[0];return o.width=e.width,o.height=e.height,o=(r=o.getContext("2d")).getImageData(0,0,e.width,e.height),e.copyToImageData(o),r.putImageData(o,0,0)}function colorize(){var e=getImageData();return render(Colormaps.colorify(infragrammar_mono(e),function(e){return colormap((e+1)/2)})),!0}function update(e){var r,o,a,t,n,i;return $("#colorbar-container")[0].style.display="none","ndvi"===mode?(r=(n=_slicedToArray(get_channels(e),3))[0],n[1],o=n[2],i=ndvi(r,o),a=-1,t=1,n=Colormaps.colorify(i,function(e){return colormap((e-a)/(t-a))}),update_colorbar(a,t)):n="raw"===mode?new JsImage(e.data,e.width,e.height,4):"nir"===mode?(r=(i=_slicedToArray(get_channels(e),3))[0],i[1],o=i[2],Colormaps.colorify(r,function(e){return[e,e,e]})):infragrammar(e),render(n)}function save_expressions(r,g,b){return""===r&&(r="R"),""===g&&(g="G"),""===b&&(b="B"),eval("r_exp = function(R,G,B){var r=R,g=G,b=B;return "+r+";}"),eval("g_exp = function(R,G,B){var r=R,g=G,b=B;return "+g+";}"),eval("b_exp = function(R,G,B){var r=R,g=G,b=B;return "+b+";}")}function save_expressions_hsv(h,s,v){return""===h&&(h="H"),""===s&&(s="S"),""===v&&(v="V"),eval("r_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[0];}"),eval("g_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[1];}"),eval("b_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[2];}")}function getImageData(){var e=$("#image")[0].getContext("2d"),r=$("#image").width(),o=$("#image").height();return image||e.getImageData(0,0,r,o)}function getJsImage(){var e=getImageData();return new JsImage(e.data,e.width,e.height,1)}function set_mode(e){return mode=e,update(getImageData()),"ndvi"===mode?$("#colormaps-group")[0].style.display="inline-block":0<$("#colormaps-group").length?$("#colormaps-group")[0].style.display="none":void 0}function updateImage(e){var r=document.getElementById("image"),o=r.getContext("2d"),a=e.videoWidth||e.width,t=e.videoHeight||e.height;return o.drawImage(e,0,0,a,t,0,0,r.width,r.height),image=o.getImageData(0,0,r.width,r.height),set_mode(mode)}function run(e){return set_mode(e)}function getCurrentImage(){return $("#image")[0].getContext("2d").canvas.toDataURL("image/jpeg")}return update_colorbar=function(e,r){var o,a,t,n,i,l,s,c,u;for($("#colorbar-container")[0].style.display="inline-block",a=(o=(t=$("#colorbar")[0]).getContext("2d")).getImageData(0,0,t.width,t.height),n=l=0,c=t.width;0<=c?l<c:c<l;n=0<=c?++l:--l)for(i=s=0,u=t.height;0<=u?s<u:u<s;i=0<=u?++s:--s){var m=_slicedToArray(colormap(n/t.width),3),d=m[0],g=m[1],p=m[2],m=4*(n+i*t.width);a.data[0+m]=d,a.data[1+m]=g,a.data[2+m]=p,a.data[3+m]=255}return o.putImageData(a,0,0),$("#colorbar-min")[0].textContent=e.toFixed(2),$("#colorbar-max")[0].textContent=r.toFixed(2)},{type:"javascript",colormap:colormap,getCurrentImage:getCurrentImage,getImageData:getImageData,getJsImage:getJsImage,infragrammar_mono:infragrammar_mono,infragrammar:infragrammar,render:render,run:run,save_expressions:save_expressions,save_expressions_hsv:save_expressions_hsv,update:update,updateImage:updateImage,colorize:colorize,initialize:function(){}}}},{"../color/colormaps":5,"../color/converters":6,"../util/JsImage.js":17}],11:[function(b,e,r){e.exports=function(e){var o,a=null,r=null,i=[-1,-1,-1,1,1,-1,1,1],t=0,l=b("../util/webgl-utils")(),n=!1,s={default:0,stretched:2,grey:1},c=s.default;function u(e){return console.log(e,"webgl"),(e=e||{}).shaderVertPath=e.shaderVertPath||"dist/shader.vert",e.shaderFragPath=e.shaderFragPath||"dist/shader.frag",e.shadersLoadedCallback=e.shadersLoadedCallback||function(){console.log("shaders loaded")},a=d("raw",1,0,1,"image"),r=d("raw",1,1,1,"colorbar"),m(),t=2,$("#shader-vs").load(e.shaderVertPath,h),$("#shader-fs-template").load(e.shaderFragPath,h),!(!a||!r)}function m(){n=!1}function d(e,r,o,a,t){var n=new Object;return n.mode=e,n.expression=["","",""],n.selColormap=r,n.colormap=o,n.slider=a,n.updateShader=!0,n.canvas=document.getElementById(t),n.canvas.addEventListener("webglcontextlost",function(e){return e.preventDefault()},!1),n.canvas.addEventListener("webglcontextrestored",f,!1),n.gl=l.getWebGLContext(n.canvas),n.gl?(n.gl.getExtension("OES_texture_float"),n.vertexBuffer=(r=i,o=(a=(o=n).gl).createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,o),a.bufferData(a.ARRAY_BUFFER,new Float32Array(r),a.STATIC_DRAW),o.itemSize=r.itemSize,o),n.framebuffer=n.gl.createFramebuffer(),n.imageTexture=(a=(t=n).gl.TEXTURE0,r=t.gl,o=r.createTexture(),r.activeTexture(a),r.bindTexture(r.TEXTURE_2D,o),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.canvas.width,t.canvas.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),o),n):null}function g(e,r){var o,a;if(r||window.requestAnimationFrame(function(){return g(e,!1)}),e.updateShader&&(e.updateShader=!1,e.shaderProgram=function(e){var r,o,a,t=_slicedToArray(e.expression,3);a=t[0],o=t[1],r=t[2],a=a.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),o=o.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),r=r.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),a=a.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),o=o.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),r=r.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),a.includes(".")||(a=a.replace(/([0-9])([^\.])?/g,"$1.0$2"));o.includes(".")||(o=o.replace(/([0-9])([^\.])?/g,"$1.0$2"));r.includes(".")||(r=r.replace(/([0-9])([^\.])?/g,"$1.0$2"));"ndvi"===e.mode&&(""!==a&&(a="(("+a+") + 1.0) / 2.0"),""!==o&&(o="(("+o+") + 1.0) / 2.0"),""!==r&&(r="(("+r+") + 1.0) / 2.0"));""===a&&(a="r");""===o&&(o="g");""===r&&(r="b");return t=(t=(t=(t=$("#shader-fs-template").html()).replace(/@1@/g,a)).replace(/@2@/g,o)).replace(/@3@/g,r),$("#shader-fs").html(t),l.createProgramFromScripts(e.gl,["shader-vs","shader-fs"])}(e)),(o=e.gl).viewport(0,0,e.canvas.width,e.canvas.height),o.useProgram(e.shaderProgram),o.bindBuffer(o.ARRAY_BUFFER,e.vertexBuffer),a=o.getAttribLocation(e.shaderProgram,"aVertexPosition"),o.enableVertexAttribArray(a),o.vertexAttribPointer(a,e.vertexBuffer.itemSize,o.FLOAT,!1,0,0),a=o.getUniformLocation(e.shaderProgram,"uSampler"),o.uniform1i(a,0),a=o.getUniformLocation(e.shaderProgram,"uSlider"),o.uniform1f(a,e.slider),a=o.getUniformLocation(e.shaderProgram,"uColorized"),o.uniform1i(a,n||e.colormap?1:0),a=o.getUniformLocation(e.shaderProgram,"uSelectColormap"),o.uniform1i(a,e.selColormap),a=o.getUniformLocation(e.shaderProgram,"uHsv"),o.uniform1i(a,"hsv"===e.mode?1:0),a=o.getUniformLocation(e.shaderProgram,"uColormap"),o.uniform1i(a,e.colormap?1:0),o.drawArrays(o.TRIANGLE_STRIP,0,i.length/i.itemSize),r)return e.canvas.toDataURL("image/jpeg")}function p(e,r){e.mode!=r&&(e.updateShader=!0),e.mode=r}function h(){if(!--t)return e.shadersLoadedCallback(),g(a),g(r)}function f(){var e=a.imageData;if(a=d(a.mode,a.selColormap,a.colormap,a.slider,"image"),r=d(r.mode,r.selColormap,r.colormap,r.slider,"colorbar"),a&&r)return v(e)}function v(e){var r=a.gl;return o=e,a.imageData=e,r.activeTexture(r.TEXTURE0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)}function w(e){return p(a,e)}return i.itemSize=2,u(e),{type:"webgl",initialize:u,getInputImage:function(){return function(e){var r=(o=document.createElement("CANVAS")).getContext("2d");o.height=e.height,o.width=e.width,r.drawImage(e,0,0);var e=o.toDataURL("image/png|gif|jpg"),o=null;return e}(o)},getCurrentImage:function(){return g(a,!0)},getImageData:function(){return a.imageData},run:w,save_expressions:function(e,r,o){return a.expression=[e,r,o]},setMode:p,updateImage:v,decolorize:m,colorize:function(e){"hsv"===e?w("hsv"):(c=e=e||c,console.log("colorize:"+e),a.selColormap=r.selColormap=e="string"==typeof e?s[e]:e,n=!0)},context:a}}},{"../util/webgl-utils":18}],12:[function(e,r,o){r.exports=function(e,r){$("#infragrammar_hsv").submit(function(){return console.log("hsv mode"),e.mode="infragrammar_hsv",e.logger.log_hsv(),r(),e.run(e.mode),e.run(),!0}),$("#infragrammar").submit(function(){return console.log("infragrammar mode"),e.mode="infragrammar",e.logger.log_rgb(),r(),e.run(e.mode),e.run(),!0}),$("#infragrammar_mono").submit(function(){return console.log("infragrammar mono mode"),e.mode="infragrammar_mono",e.logger.log_mono(),r(),e.run(e.mode),e.run(),!0})}},{}],13:[function(e,r,o){r.exports=function(e){function r(){console.log("colorized on"),e.colorized=!0,$("#btn-colorize").addClass("active"),$("#colorbar-container").css("display","inline-block"),$("#colormaps-group").css("display","inline-block")}$(".btn-colorize").click(function(){return e.colorized?(console.log("colorized off"),e.colorized=!1,$("#btn-colorize").removeClass("active"),$("#colorbar-container").css("display","none"),$("#colormaps-group").css("display","none"),e.run(e.mode),e.processor.decolorize()):(r(),e.run(e.mode),e.colorize())}),$("#default_colormap").click(function(){return console.log("default colormap"),r(),e.colorize("default"),e.run(e.mode),$("#btn-colorize").addClass("active")}),$("#stretched_colormap").click(function(){return console.log("stretched colormap"),r(),e.colorize("stretched"),e.run(e.mode),$("#btn-colorize").addClass("active")})}},{}],14:[function(e,r,o){r.exports=function(e){var r=!1;$(".fullscreen").click(function(){return r=r?($("#image").css("display","inline"),$("#image").css("position","relative"),$("#image").css("height","auto"),$("#image").css("left",0),$("#backdrop").hide(),$(".btn.fullscreen").show(),!1):($("#image").css("display","block"),$("#image").css("height","100%"),$("#image").css("width","auto"),$("#image").css("position","absolute"),$("#image").css("top","0px"),$("#image").css("left",parseInt((window.innerWidth-$("#image").width())/2)+"px"),$("#image").css("z-index","2"),$("#backdrop").show(),$(".btn.fullscreen").hide(),!0)})}},{}],15:[function(t,e,r){e.exports=function(o){o.imageSelector=o.imageSelector||"#image-container",o.fileSelector=o.fileSelector||"#file-sel";var a=t("urlhash")();o.logger,t("../color/colormaps");function e(){return o.mode=$("#modeSwitcher").val(),function(e){if(console.log(e),"infragrammar"===o.mode)o.processor.save_expressions(e.r,e.g,e.b);else if("infragrammar_mono"===o.mode)o.processor.save_expressions(e.m,e.m,e.m);else if("infragrammar_hsv"===o.mode)return o.processor.save_expressions_hsv(e.h,e.s,e.v)}({r:$("#r_exp").val(),g:$("#g_exp").val(),b:$("#b_exp").val(),m:$("#m_exp").val(),h:$("#h_exp").val(),s:$("#s_exp").val(),v:$("#v_exp").val()})}$(document).ready(function(){function r(e){$("#overlay-img").width(80*e),$("#overlay-img").height(80*e*.625),$("#overlay-size").html(e),console.log("saved grid "+e)}return t("./fullscreen")(o),t("../ui/presets")(o,e),t("../ui/analysis")(o,e),t("../ui/colorize")(o),$(o.imageSelector).ready(function(){var e;return $("#overlay-slider").val(localStorage.getItem("overlaySize")),console.log("grid "+localStorage.getItem("overlaySize")),r($("#overlay-slider").val()),(e=a.getUrlHashParameter("src"))&&(params=parametersObject(location.search.split("?")[1]),o.mode=params.mode,fetch_image(e)),!0}),$(o.fileSelector).change(function(){$(".choose-prompt").hide(),$("#save-modal-btn").show(),$("#save-zone").show();var e=new FileReader;return e.onload=function(e){var r=new Image;return r.onload=function(){o.processor.updateImage(this)},r.src=e.target.result},e.readAsDataURL(this.files[0]),$("#preset-modal").modal("show"),!0}),$("#webcam-activate").click(function(){return $(".choose-prompt").hide(),$("#save-modal-btn").show(),$("#save-zone").show(),e(),o.video(),$("#preset-modal").modal("show"),!0}),$("#snapshot").click(function(){return o.camera.getSnapshot(),!0}),$("#modeSwitcher").change(function(){return $("#infragrammar, #infragrammar_mono, #infragrammar_hsv").hide(),$("#"+$("#modeSwitcher").val()).css("display","inline"),!0}),$("#overlay-btn").click(function(){$("#overlay-container").toggle(),$("#overlay-controls-container").toggle(),$("#overlay-btn").toggleClass("btn-success")}),$("#overlay-slider").on("input",function(){r($("#overlay-slider").val())}),$("#overlay-save-btn").click(function(){localStorage.setItem("overlaySize",$("#overlay-slider").val()),$("#overlay-save-info").show().delay(2e3).fadeOut()}),$("[rel=tooltip]").tooltip(),$("[rel=popover]").popover(),!0})}},{"../color/colormaps":5,"../ui/analysis":12,"../ui/colorize":13,"../ui/presets":16,"./fullscreen":14,urlhash:1}],16:[function(e,r,o){r.exports=function(e,r){function o(){console.log("colorized on"),e.colorized=!0,$("#btn-colorize").addClass("active"),$("#colorbar-container").css("display","inline-block"),$("#colormaps-group").css("display","inline-block")}function a(){console.log("colorized off"),e.colorized=!1,$("#btn-colorize").removeClass("active"),$("#colorbar-container").css("display","none"),$("#colormaps-group").css("display","none")}$("#preset_raw").click(function(){return $("#modeSwitcher").val("infragrammar").change(),$("#r_exp").val("R"),$("#g_exp").val("G"),$("#b_exp").val("B"),$("#preset-modal").modal("hide"),e.colorized=!1,e.processor.decolorize(),r(),a(),e.run(e.mode)}),$("#preset_ndvi_blue").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(R-B)/(R+B)"),$("#preset-modal").modal("hide"),e.colorized=!1,e.processor.decolorize(),r(),a(),e.run(e.mode)}),$("#preset_ndvi_blue_color").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(R-B)/(R+B)"),$("#preset-modal").modal("hide"),r(),e.colorized=!0,e.run(e.mode),e.colorize(),o(),e.run()}),$("#preset_ndvi_red").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(B-R)/(B+R)"),$("#preset-modal").modal("hide"),e.colorized=!1,e.processor.decolorize(),r(),a(),e.run(e.mode)}),$("#preset_ndvi_red_color").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(B-R)/(B+R)"),$("#preset-modal").modal("hide"),r(),o(),e.run(e.mode),e.colorize(),e.run()})}},{}],17:[function(e,r,o){r.exports=function(){function t(e,r,o,a){_classCallCheck(this,t),this.data=e,this.width=r,this.height=o,this.channels=a}return _createClass(t,[{key:"copyToImageData",value:function(e){return e.data.set(this.data)}},{key:"extrema",value:function(){for(var e,r,o,a,t=this.width*this.height,n=function(){var e,r,o=[];for(s=e=0,r=this.channels;0<=r?e<r:r<e;s=0<=r?++e:--e)o.push(this.data[s]);return o}.call(this),i=function(){var e,r,o=[];for(s=e=0,r=this.channels;0<=r?e<r:r<e;s=0<=r?++e:--e)o.push(this.data[s]);return o}.call(this),l=0,s=r=0,c=t;0<=c?r<c:c<r;s=0<=c?++r:--r)for(e=o=0,a=this.channels;0<=a?o<a:a<o;e=0<=a?++o:--o)this.data[l]>i[e]&&(i[e]=this.data[l]),this.data[l]<n[e]&&(n[e]=this.data[l]),l++;return[n,i]}}]),t}()},{}],18:[function(e,r,o){r.exports=function(){function o(){return window!=window.top}function a(){o()&&(document.body.className="iframe")}function l(e,r,o,a,t){for(var t=t||c,n=e.createProgram(),i=0;i<r.length;++i)e.attachShader(n,r[i]);if(o)for(i=0;i<o.length;++i)e.bindAttribLocation(n,a?a[i]:i,o[i]);return e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)?n:(t("Error in program linking:"+e.getProgramInfoLog(n)),e.deleteProgram(n),null)}function s(e,r,o,a){var t,n=document.getElementById(r);if(!n)throw"*** Error: unknown script element"+r;if(r=n.text,!o)if("x-shader/x-vertex"==n.type)t=e.VERTEX_SHADER;else if("x-shader/x-fragment"==n.type)t=e.FRAGMENT_SHADER;else if(t!=e.VERTEX_SHADER&&t!=e.FRAGMENT_SHADER)throw"*** Error: unknown shader type";return function(e,r,o,a){a=a||c,o=e.createShader(o);return e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(a("*** Error compiling shader '"+o+"':"+e.getShaderInfoLog(o)),e.deleteShader(o),null)}(e,r,o||t,a)}var c=function(e){window.console&&(window.console.error?window.console.error(e):window.console.log&&window.console.log(e))},t=function(e,r){for(var o=["webgl","experimental-webgl"],a=null,t=0;t<o.length;++t){try{a=e.getContext(o[t],r)}catch(e){}if(a)break}return a},u=["VERTEX_SHADER","FRAGMENT_SHADER"],n=["","MOZ_","OP_","WEBKIT_"],e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,r){return window.setTimeout(e,1e3/60)},r=window.cancelCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout;return{createProgram:l,createProgramFromScripts:function(e,r,o,a,t){for(var n=[],i=0;i<r.length;++i)n.push(s(e,r[i],e[u[i]],t));return l(e,n,o,a,t)},createShaderFromScriptElement:s,getWebGLContext:function(e,r){return o()&&(a(),e.width=e.clientWidth,e.height=e.clientHeight),function(e,r){if(!window.WebGLRenderingContext)return null;r=t(e,r);return r}(e,r)},updateCSSIfInIFrame:a,getExtensionWithKnownPrefixes:function(e,r){for(var o=0;o<n.length;++o){var a=e.getExtension(n[o]+r);if(a)return a}},resizeCanvasToDisplaySize:function(e){e.width==e.clientWidth&&e.height==e.clientHeight||(e.width=e.clientWidth,e.height=e.clientHeight)},requestAnimFrame:e,cancelRequestAnimFrame:r}}},{}]},{},[2]);